<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" href="../../assets/css/layui.css">
  <link rel="stylesheet" href="../../assets/css/view.css" />
  <link rel="stylesheet" href="../../assets/css/tankuang.css" />

  <link rel="icon" href="/favicon.ico">
  <title>订单管理</title>
  <style>
    .beijingCeng_t {
      word-wrap: break-word;
      word-break: break-all;
      overflow: hidden;
      width: 70%;
      margin-left: 15%;
      height: 390px;
      position: fixed;
      top: 50%;
      margin-top: -200px;
      background: #fff;
      border-radius: 10px;
      overflow: scroll;
    }
  </style>
</head>

<body class="layui-view-body">
  <div class="layui-row">
    <div>
      <div class="layui-content">
        <div class="layui-row">
          <div class="layui-card">
            <div class="layui-card-body">
              <div class="form-box">
                <div class="layui-form layui-form-item">
                  <div class="layui-col-xs3">
                    <div class="layui-form-mid" style="float: left;">过滤条件:</div>
                    <div class="layui-input-inline" style="width: 160px;">
                      <input type="text" autocomplete="off" class="layui-input" id="shop_name">
                    </div>
                  </div>
                  <!-- <div class="layui-col-xs3">
                           <div class="layui-form-mid" style="float: left;">发货人：</div>
                        <div class="layui-input-inline" style="width: 160px;">
                          <input type="text" autocomplete="off" class="layui-input" id="sccs">
                        </div>
                        </div>
                           <div class="layui-col-xs3">
                           <div class="layui-form-mid" style="float: left;">批号:</div>
                        <div class="layui-input-inline" style="width: 160px;">
                          <input type="text" autocomplete="off" class="layui-input" id="pihao">
                        </div>
                         </div> -->

                  <button class="layui-btn layui-btn-blue" style="margin-top: 0px;" onclick="addListDate()"><i
                      class="layui-icon">&#xe654;</i>添加任务</button>

                </div>



                <table id="demo"></table>

                <!-- 遮罩层1 公司名称弹框 -->
                <div class="zezhaoceng3" id="zezhaoceng3">
                  <div class="beijingCeng_t" style=" word-wrap: break-word;  word-break: break-all;  overflow: hidden;">
                    <div id="beijingCengBtn3"
                      style="position: absolute;z-index: 88;right: 13px;top: 10px;color:red;width: 20px;height: 20px;">
                      <i class="layui-icon" style="font-size: 30px;">&#x1007;</i>
                    </div>
                    <div class="layui-row">
                      <div class="layui-card">
                        <div class="layui-card-body">

                          <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;" id="t_bt">
                            <legend>修改任务信息</legend>
                          </fieldset>

                          <div class="inputStyle2" style="margin-top:-1rem;width: 50%;float: left;">
                            <div class="layui-form-mid" style="margin-top:15px;width: 30%;text-align: right">
                              发货人名称：
                            </div>
                            <div class="layui-form-mid" style=" width: 50%;margin-top:5px;">
                              <input type="hidden" id="code" class="layui-input">
                              <input type="text" id="fhrName" class="layui-input"></div>
                          </div>
                          <div class="inputStyle2" style="margin-top:-1rem;width: 45%; float: right;">
                            <div class="layui-form-mid" style="margin-top:8px;width: 30%;text-align: right">发货人地址：
                            </div>
                            <div class="layui-form-mid" style="width: 60%;">
                              <input type="text" id="fhrAddress" class="layui-input"></div>
                          </div>
                          <div class="inputStyle2" style="  width: 45%;float: right;">
                            <div class="layui-form-mid" style="width: 30%;margin-top:8px;width: 30%;text-align: right">
                              发货人手机：
                            </div>
                            <div class="layui-form-mid" style="width: 60%;">
                              <input type="text" id="fhrPhone" class="layui-input"></div>
                          </div>



                          <div class="inputStyle2" style="margin-top:8px;width: 50%;float: left;">
                            <div class="layui-form-mid" style="width: 30%;margin-top:8px;width: 30%;text-align: right">
                              收货人姓名 ：
                            </div>
                            <div class="layui-form-mid" style="color:forestgreen;width: 50%;">
                              <input type="text" id="shrname" class="layui-input"></div>
                          </div>
                          <div class="inputStyle2" style="margin-top:8px; width: 45%;float: right;">
                            <div class="layui-form-mid" style="width: 30%;margin-top:8px;width: 30%;text-align: right">
                              收货人地址：
                            </div>
                            <div class="layui-form-mid" style="width: 60%;">
                              <input type="text" id="shrAddress" class="layui-input"></div>
                          </div>
                          <div class="inputStyle2" style="margin-top:8px;width: 50%;float: left;">
                            <div class="layui-form-mid" style="width: 30%;margin-top:8px;width: 30%;text-align: right">
                              收货人手机 ：
                            </div>
                            <div class="layui-form-mid" style="color:forestgreen;width: 50%;">
                              <input type="text" id="shrPhone" class="layui-input"></div>
                          </div>

                          <div class="inputStyle2" style="margin-top:8px; width: 45%;float: right;">
                            <div class="layui-form-mid" style="width: 30%;margin-top:8px;width: 30%;text-align: right">
                              商品msg：
                            </div>
                            <div class="layui-form-mid" style="width: 60%;">
                              <input type="text" id="shopMsg" class="layui-input"></div>
                          </div>
                          <div class="inputStyle2" style="margin-top:8px; width: 50%;float: left;">
                            <div class="layui-form-mid" style="width: 30%;margin-top:8px;width: 30%;text-align: right">
                              订单类型：
                            </div>
                            <div class="layui-form-mid" style="width: 50%;">
                              <input type="text" id="orderType" class="layui-input"></div>
                          </div>
                          <div class="inputStyle2" style="  width: 100%; float: left;">
                            <div class="layui-form-mid" style="width: 15%;margin-top:8px;text-align: right">
                              备注 ：
                            </div>
                            <div class="layui-form-mid" style="color:forestgreen;width: 80%;">
                              <input type="text" id="beizhu" class="layui-input"></div>
                          </div>
                        </div>
                        <div style="width: 100%;float: left;margin-top: 10px;margin-left: 40%">
                          <button class="layui-btn layui-btn-blue" style="margin-left: 0%;" id="RoleListAddBtn"
                            onclick="f_save();return false;">保存</button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>


                <!-- 遮罩层1 公司名称弹框 -->
                <div class="zezhaoceng" id="zezhaoceng">
                  <div class="beijingCeng">
                    <div id="beijingCengBtn"
                      style="position: absolute;z-index: 88;right: 13px;top: 10px;color:red;width: 20px;height: 20px;">
                      <i class="layui-icon" style="font-size: 30px;">&#x1007;</i>
                    </div>
                    <div class="layui-row">
                      <div class="layui-card">
                        <div class="layui-card-body">
                          <div class="form-box">
                            <div class="layui-form layui-form-item">
                              <div class="layui-inline">
                                <div class="layui-form-mid">产品名称:</div>
                                <div class="layui-input-inline" style="width: 100px;">
                                  <input type="text" autocomplete="off" class="layui-input" id="shopListInput"
                                    onkeydown="inputchanPinMCD(event);">
                                </div>

                                <button class="layui-btn layui-btn-blue" id="shopListBtn">查询</button>
                              </div>
                            </div>
                            <table id="demo1"></table>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  </div>




  <script src="../../assets/layui.all.js"></script>
  <script src="../../assets/jquery.js" type="text/javascript"></script>

  <script src="./kongjianFZ/zezhaoceng.js"></script>
  <script src="./kongjianFZ/djbhOrgwid.js"></script>
  <script src="./kongjianFZ/jiaoyan.js"></script>

  <script src="../js/_URL.js"></script>
  <script>
    var element = layui.element;
    var table = layui.table;
    var $form = layui.form;
    var isTypebNum = 0;
    var laydate = layui.laydate;
    var $ = layui.$;
    var $layer = layui.layer;
    var DateListArr = "";
    var userDate = JSON.parse(window.sessionStorage.getItem("userNameList"));
    var isshow = true;
    var url = _url();
    var url1 = _urlJson();
    var shopmx = {};
    var serverCode = _serverCode();

    var BumenListArr = {};
    // 订单列表数据
    var RoleListArr = {};
    // 选中订单数据
    var RoleArr = {}
    // 外边选中订单数据
    var RoleWArr = {}
    var RoleListWArr = {}
    function ydaddListDate() {
      if (layui.table.checkStatus('demo').data.length < 1) {
        alert('最少选择一个订单');
        return;
      }
      var ss = "";
      for (let index = 0; index < layui.table.checkStatus('demo').data.length; index++) {
        Array = layui.table.checkStatus('demo').data[index];
        ss += Array.order_id + ",";
      }
      // alert(ss +userDate.userid);

      $layer.load();
      var data = "UserID=" + $("#siji").val() + "&OrderArr=" + ss + "&UserName=" + userDate.userid; //序列化表单数据 
      $.getJSON(url + "OrderSCYunselect?" + data,
        function (json) {
          RoleListWArr = json.Response.RDATA;
          $layer.closeAll('loading');
          callback(RoleListWXH(RoleListWArr), RoleListWArr);
          return;
        })
    }





    function addListDate() {
      var $input = document.getElementById("zezhaoceng3");
      $input.style.display = "block";
      $("#code2").css('visibility', 'visible');
      $("#t_bt").html("<legend>添加订单信息</legend>");
      $("#RoleListAddBtn").attr({
        "onclick": "f_save();"
      });
      document.getElementById('name').focus();
      $("#name").val("");

      $("#fhrAddress").val("");
      $("#fhrPhone").val("");
      $("#shrPhone").val("");
      $("#shrname").val("");
      $("#shrAddress").val("");
      $("#orderType").val("");
      $("#shopMsg").val("");
      $("#beizhu").val("");
    }

    function RoleListWClick(index) {

      RoleWArr = RoleListWArr[index];
      var $input1 = document.getElementById("zezhaoceng3");
      $input1.style.display = "block";
      $("#code2").css('visibility', 'hidden');
      $("#RoleListAddBtn").attr({
        "onclick": "f_updata();"
      });
      $("#t_bt").html("<legend>修改订单信息</legend>");
      $("#name").val(RoleWArr.fhrName);
      $("#fhrAddress").val(RoleWArr.fhrAddress);
      $("#fhrPhone").val(RoleWArr.fhrPhone);
      $("#shrname").val(RoleWArr.shrname);
      $("#shrAddress").val(RoleWArr.shrAddress);
      $("#beizhu").val(RoleWArr.beizhu);
      $("#code").val(RoleWArr.orderid);

      $("#shopMsg").val(RoleWArr.shopMsg);

    }
    function f_save() {
      if ($("#name").val() == "") {
        layer.msg('名称不能为空', function () {
          return;
        });
        return;
      }

      $layer.load();
      var data = "fhrName=" + $("#fhrName").val() +
        "&fhrAddress=" + $("#fhrAddress").val() +
        "&fhrPhone=" + $("#fhrPhone").val() +
        "&shrPhone=" + $("#shrPhone").val() +

        "&orderid=" + Math.floor(Math.random() * 99999 + 1) +
        "&beizhu=" + $("#beizhu").val() +

        "&shrname=" + $("#shrname").val() +
        "&shrAddress=" + $("#shrAddress").val() +
        "&orderType=" + $("#orderType").val() +
        "&shopMsg=" + $("#shopMsg").val();



      $.getJSON(url + "orderAdd?" + data,
        function (json) {
          if (json.Response.code > 0) {
            alert(json.Response.msg)
            $layer.closeAll('loading');
            var $input1 = document.getElementById("zezhaoceng3");
            $input1.style.display = "none";

            RoleListWDate("", "JH", $("#RoleListInput").val(), url, serverCode, "",
              function (
                date, RoleListArr1) {
                table.render(date);
                RoleListWArr = RoleListArr1;

              });

          } else {
            $layer.closeAll('loading');
            $layer.msg("没有数据", {
              icon: 5
            });
            return;
          }
        })
    }
    function f_updata() {
      ;
      $layer.load();
      var data = "fhrName=" + $("#fhrName").val() +
        "&fhrAddress=" + $("#fhrAddress").val() +
        "&fhrPhone=" + $("#fhrPhone").val() +
        "&shrPhone=" + $("#shrPhone").val() +

        "&orderid=" + $("#code").val() +
        "&beizhu=" + $("#beizhu").val() +

        "&shrname=" + $("#shrname").val() +
        "&shrAddress=" + $("#shrAddress").val() +
        "&orderType=" + $("#orderType").val() +
        "&shopMsg=" + $("#shopMsg").val();

      $.getJSON(url + "orderupdate?" + data,
        function (json) {
          if (json.Response.code > 0) {
            alert(json.Response.msg)
            $layer.closeAll('loading');

            var $input1 = document.getElementById("zezhaoceng3");
            $input1.style.display = "none";

            RoleListWDate("", "JH", $("#RoleListInput").val(), url, serverCode, "",
              function (date, RoleListArr1) {
                table.render(date);
                RoleListWArr = RoleListArr1;

              });

          } else {
            $layer.closeAll('loading');
            $layer.msg("没有数据", {
              icon: 5
            });
            return;
          }
        })
    }




    function RoleListWDClick(index) {
      RoleWArr = RoleListWArr[index];
      if (window.confirm("确认删除")) {
        var data = "orderid=" + RoleWArr.orderid;
        //alert(JSON.stringify(data))
        $.getJSON(url + "orderdelete?" + data,
          function (json) {

            if (json.Response.code > 0) {
              alert(json.Response.msg)
              $layer.closeAll('loading');

              window.location.reload();
            } else {
              $layer.msg("删除失败", {
                icon: 5
              });
              $layer.closeAll('loading');
            }
          })
      } else {
        return;
      }
    }


    layui.use(['form', 'element'], function () {
      var form = layui.form;
    });
    // 按钮点击事件
    $("#shopListBtn").click(function () {
      CXSHOPMX(function (
        date, RoleListArr1) {
        table.render(date);
      });
    })

    function CXSHOPMX(callback) {
      $layer.load();

      // alert(shopmx.order_id)

      //     $("#shopListInput").val()
      $("#renwuRongQi").empty();
      var data = "orderid=" + shopmx.order_id; //序列化表单数据 
      $.getJSON(url + "orderDetailsSelect?" + data,
        function (json) {
          // alert(JSON.stringify(json))
          SHOPArr = json.Response.RDATA;
          $layer.closeAll('loading');
          callback(SHOPMXtWXH(SHOPArr), SHOPArr);
          return;
        })
    }

    function CKMXClick(index) {
      var $input = document.getElementById("zezhaoceng");
      $input.style.display = "block";

      shopmx = RoleListWArr[index];

      CXSHOPMX(function (
        date, RoleListArr1) {
        table.render(date);
      });
    }

    function SHOPMXtWXH(dataList) {
      for (var i = 0; i < dataList.length; i++) {
        dataList[i].code = (i + 1);

      }
      return SHOPMXTAB(dataList);
    }
    function SHOPMXTAB(dataList) {
      return {
        elem: '#demo1',
        cols: [
          [ //标题栏
            {
              field: 'code',
              title: '编号',
              width: 90
            }, {
              field: 'shopid',
              title: '商品ID',
              width: 120
            }, {
              field: 'shopName',
              title: '商品名称',
              width: 170
            }, {
              field: 'shopNum',
              title: '商品数',
              width: 170
            }, {
              field: 'shopDetails',
              title: '商品明细',
              width: 170,

            }, {
              field: 'shopnomey',
              title: '商品价格',
              width: 120,
            }, {
              field: 'shopbulk',
              title: '商品体积',
              width: 120,
            },

            //   {
            //   field: 'BtnStyle',
            //   width: 80,
            //   title: '操作',
            //   fixed: 'right',
            // }
          ]
        ],
        data: dataList,
        skin: 'line' //表格风格
        ,
        even: true,
        page: true //是否显示分页
        ,
        limits: [10, 20],
        limit: 10,

        done: function (res, page, count) {
          var that = this.elem.next();
          //alert(JSON.stringify(res))

          console.log(that);
          res.data.forEach(function (item, index) {

            // var tr = that.find(".layui-table-box tbody tr[data-index='" + index + "']").attr("onclick",
            //   "search2('" + index + "','" + res.data[index].ID + "')");

          });
        }
      };
    }
    function RoleListWXR(dataList) {
      return {
        elem: '#demo',
        cols: [
          [ //标题栏
            {
              type: 'checkbox'
            }, {
              field: 'code',
              title: '编号',
              width: 70
            }, {
              field: 'order_id',
              title: '订单ID',
              width: 180
            }, {
              field: 'order_type',
              title: '订单类型',
              width: 150
            }, {
              field: 'fhrName',
              title: '发货人姓名',
              width: 110
            }, {
              field: 'fhrAddress',
              title: '发货人地址',
              width: 120
            }, {
              field: 'fhrPhone',
              title: '发货人手机',
              width: 170,
            }, {
              field: 'consignee_GSMC',
              title: '收货人单位',
              width: 110
            }, {
              field: 'shrName',
              title: '收货人姓名',
              width: 110
            }, {
              field: 'shrAddress',
              title: '收货人地址',
              width: 120
            }, {
              field: 'shrPhone',
              title: '收货人手机',
              width: 170,
            }, {
              field: 'zjjs',
              title: '整件件数',
              width: 120,
            }, {
              field: 'lsjs',
              title: '零散件数',
              width: 120,
            }, {
              field: 'hw_type',
              title: '货物类型',
              width: 120,
            },  {
              field: 'sk_state',
              title: '付款方式',
              width: 120,
            }, {
              field: 'ygjz',
              title: '预估价值',
              width: 120,
            },  {
              field: 'createtime',
              title: '创建时间',
              width: 120,
            }, {
              field: 'sk_nomey',
              title: '收款金额',
              width: 120
            }, {
              field: 'BtnStyle',
              width: 130,
              title: '操作',
              fixed: 'right',
            }
          ]
        ],
        data: dataList,
        skin: 'line' //表格风格
        ,
        even: true,
        page: true //是否显示分页
        ,
        height: window.innerHeight - 160 + "px",
        limits: [10, 20],
        limit: 10,
        done: function (res, page, count) {
          var that = this.elem.next();
          //alert(JSON.stringify(res))

          console.log(that);
          res.data.forEach(function (item, index) {

            // var tr = that.find(".layui-table-box tbody tr[data-index='" + index + "']").attr("onclick",
            //   "search2('" + index + "','" + res.data[index].ID + "')");

          });
        }
      }; table.on('toolbar(test)', function (obj) {
        var checkStatus = table.checkStatus(obj.config.id); //获取选中行状态
        switch (obj.event) {
          case 'getCheckData':
            var data = checkStatus.data; //获取选中行数据
            layer.alert(JSON.stringify(data));
            break;
        };
      });
    }
    function RoleListWXH(dataList) {
      for (var i = 0; i < dataList.length; i++) {
        dataList[i].code = (i + 1);
        dataList[i].BtnStyle = "<div>" +
          "<div style='float: left;padding: 0px 5px;background: #177ce3;border-radius: 2px;color: #fff;' onclick='CKMXClick(" +
          i + ")'><i class='layui-icon'>&#xe615;</i></div>" +
          "<div style='margin-left:10px;float: left;padding: 0px 5px;background: #177ce3;border-radius: 2px;color: #fff;' onclick='RoleListWClick(" +
          i + ")'><i class='layui-icon'>&#xe642;</i></div>" +
          "<div style='margin-left:10px;float: left;padding: 0px 5px;background: red;border-radius: 2px;color: #fff;' onclick='RoleListWDClick(" +
          i + ")'><i class='layui-icon'>&#xe640;</i></div>" +
          "</div>"
      }
      return RoleListWXR(dataList);
    }

    function RoleListWDate(Staff_ID, djlx, Value1, url, serverCode, USERID, callback) {
      $layer.load();

      $("#renwuRongQi").empty();
      var data = ""; //序列化表单数据 
      $.getJSON(url + "OrderYunselect?" + data,
        function (json) {
          RoleListWArr = json.Response.RDATA;
          $layer.closeAll('loading');
          callback(RoleListWXH(RoleListWArr), RoleListWArr);
          return;
        })
    }


    $(document).ready(function () {
      RoleListWDate(userDate.USERID, "JH", $("#RoleListInput").val(), url, serverCode, userDate.USERCODE, function (
        date, RoleListArr1) {
        table.render(date);
        RoleListWArr = RoleListArr1;
      });
      //常规用法
      laydate.render({
        elem: '#G_Date',
        value: timeDate1(0),
        isInitValue: true
      });
      slect_siji();
    })

    function slect_siji() {
      $layer.load();
      var data = ""; //序列化表单数据 
      $.getJSON(url + "getAll?" + data,
        function (json) {

          $(".selector").empty();
          $layer.closeAll('loading');
          //alert(JSON.stringify(json.Response.RDATA.length))
          for (let index = 0; index < json.Response.RDATA.length; index++) {


            $("#siji").append("<option value=" + json.Response.RDATA[index].userid + ">" + json.Response.RDATA[index].userName + "</option>");
          }
          layui.form.render("select");

        })
    }

  </script>
</body>

</html>