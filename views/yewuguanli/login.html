<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" href="../../assets/css/layui.css">
  <link rel="stylesheet" href="../../assets/css/view.css" />
  <link rel="stylesheet" href="../../assets/css/tankuang.css" />
  <link rel="icon" href="/favicon.ico">
  <title>注册管理</title>
</head>
<style>
  .beijingCeng4 {
    width: 50%;
    margin-left: 25%;
    height: 500px;
    position: fixed;
    top: 40%;
    margin-top: -200px;
    background: #fff;
    border-radius: 10px;
    overflow: scroll;
  }

  .portlet-title {
    
    border-bottom: 1px solid #eee;
    padding: 0px 0px 0px  0px;
    border-bottom: 1px solid #eee;
    color: #fff !important;
    background-color:cornflowerblue;
    height: 2.2rem;
    margin-bottom:  -0.51rem;
     
    
}
.caption {
    float: left;
    display: inline-block;
    font-size: 15px;
    font-weight: 400;
    margin: 0;
    padding: 0;
    margin-bottom: -0.7rem;
    verflow:hidden;
}
.actions {
  display: inline-block;
   padding: 0;
    margin: 0;
     
    float: right;
    
     
}
</style>

<body class="layui-view-body">
  <div class="layui-content">
    <div class="layui-page-header">
      <div class="pagewrap">
        <span class="layui-breadcrumb">
          <a href="">首页</a>
          <a href="./xiangmu.html">项目</a>
          <a href="">注册管理</a>
        </span>
        <span class="shuaxinYenmian" onclick="shuaxinBtn()">
          刷新
        </span>
      </div>
    </div>
    <div class="layui-row">
      <div class="layui-card">
        <div class="layui-card-body">
          <div class="form-box">
            <div class="portlet-title">
              <div class="actions">
                <button class="layui-btn layui-btn-blue  " onclick="addListDate()"><i class="layui-icon">&#xe654;</i>新
                  增</button>
              </div>
              <div class="actions">
                <button class="layui-btn layui-btn-blue " onclick="UpdateDate()"><i class="layui-icon">&#xe642;</i>编
                  辑</button>
              </div>
              <div class="actions">
                <button class="layui-btn layui-btn-blue " onclick="deleteVisit()"><i class="layui-icon">&#xe640;</i>删
                  除</button>
              </div>

            </div>
         
            <table id="demo"></table>
          </div>
        </div>
      </div>
    </div>
    <!-- 遮罩层1 公司名称弹框 -->
    <div class="zezhaoceng3" id="zezhaoceng3">
      <div class="beijingCeng4">
        <div id="beijingCengBtn3"
          style="position: absolute;z-index: 88;right: 13px;top: 10px;color:red;width: 20px;height: 20px;">
          <i class="layui-icon" style="font-size: 30px;">&#x1007;</i>
        </div>
        <div class="layui-row">
          <div class="layui-card">
            <div class="layui-card-body">
              <div class="form-box">
                <div class="layui-form layui-form-item">
                  <fieldset class="layui-elem-field layui-field-title" style="margin-top: 2px; " id="t_bt">
                    <legend>修改活动信息</legend>
                  </fieldset>

                  <div class="inputStyle2" style=" margin-top:-15px;float: center;">
                    <div class="layui-form-mid" style="margin-top:15px;width: 20%;text-align: right">
                      注册名称：
                    </div>
                    <div class="layui-form-mid" style=" width: 70%;margin-top:5px;">
                      <input type="hidden" id="code" class="layui-input">

                      <input type="hidden" id="createtime" class="layui-input">
                      <input type="text" id="name" class="layui-input"></div>
                  </div>


                  <div class="inputStyle2" style="margin-top:8px; float: center;">
                    <div class="layui-form-mid" style="margin-top:8px;width: 20%;text-align: right">等级：
                    </div>
                    <div class="layui-form-mid" style="width: 70%;" id="rank">
                      <!-- <select >
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                      </select> -->
                      
                  </div>
                </div>
                  <div class="inputStyle2" style="margin-top:8px; float: center;">
                    <div class="layui-form-mid" style="margin-top:8px;width: 20%;text-align: right">状态：
                    </div>
                    <div class="layui-form-mid" style="width: 70%;">
                      <select id="type">
                        <option value="1">已完成</option>
                        <option value="0">未完成</option>
                      </select>

                    </div>
                  </div>
                    <div class="inputStyle2" style="margin-top:8px; float: center;">
                      <div class="layui-form-mid" style="margin-top:8px;width: 20%;text-align: right">注册描述：
                      </div>
                      <div class="layui-form-mid" style="width: 70%;">
                        <textarea cols="50" rows="12" id="content" name="context" wrap="hard"></textarea>
                      </div>
                    </div>

                    <div style="width: 100%;float: left;margin-top: 10px;margin-left: 45%">

                      <button class="layui-btn layui-btn-blue" style="margin-left: 0%;" id="RoleListAddBtn"
                        onclick="ceshi1()">保存</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 遮罩层1 公司名称弹框 -->
      <div class="zezhaoceng4" id="zezhaoceng4">
        <div class="beijingCeng4">
          <div id="beijingCengBtn4"
            style="position: absolute;z-index: 88;right: 13px;top: 10px;color:red;width: 20px;height: 20px;">
            <i class="layui-icon" style="font-size: 30px;">&#x1007;</i>
          </div>
          <div class="layui-row">
            <div class="layui-card">
              <div class="layui-card-body">
                <div class="form-box">
                  <div class="layui-form layui-form-item">
                    <div style="width: 100%; ">
                      <table cellspacing="0" cellpadding='0' border="0" width="100%">
                        <tr>
                          <td>&nbsp;&nbsp;</td>
                        </tr>
                        <tr>
                          <td id="title2" align="center">
                            <h3></h3>
                          </td>
                        </tr>
                        <tr>
                          <td>
                            <textarea cols="70" rows="23" id="context" name="context" wrap="hard" readonly="readonly"
                              style="border: none;  overflow-x:auto ;overflow-y:auto; ">&nbsp;&nbsp;</textarea>
                          </td>
                        </tr>
                        <tr>
                          <td>&nbsp;&nbsp;</td>
                        </tr>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  
    <script src="../../assets/layui.all.js"></script>
    <script src="./kongjianFZ/zezhaoceng.js"></script>
    <script src="./kongjianFZ/djbhOrgwid.js"></script>
    <script src="./kongjianFZ/jiaoyan.js"></script>
    <script src="../js/_URL.js"></script>
    <script>
      var element = layui.element;
      var table = layui.table;
      var form = layui.form;
      var $ = layui.$;
      var $layer = layui.layer;
      var laydate = layui.laydate;
      var QRYVisitListArr = [];
      var VisitDate = "";
      var url = _url();
      var serverCode = _serverCode();
      var isshow = true;

      function VisitListWClick(index) {
        var $input1 = document.getElementById("zezhaoceng4");
        $input1.style.display = "block";
         $("#title2").html("<h3  >" + VisitListWArr[index].name + "</h3>");
        $("#context").html("&nbsp;&nbsp;" + VisitListWArr[index].content)

      }

      function UpdateDate() {
        if (layui.table.checkStatus('demo').data.length < 1 || layui.table.checkStatus('demo').data.length > 1) {
          alert('必须选择一项进行修改');
          return;
        }

        VisitWArr = layui.table.checkStatus('demo').data[0];
        var $input1 = document.getElementById("zezhaoceng3");
        $input1.style.display = "block";

        $("#RoleListAddBtn").attr({
          "onclick": "f_updata();"
        });
        $("#t_bt").html("<legend>修改</legend>");
        $("#name").val(VisitWArr.name);
        $("#content").val(VisitWArr.content);
       // $("#rank").val(VisitWArr.rank);
      //  $("#memo").val(VisitWArr.memo);
      //  $("#createtime").val(VisitWArr.createtime);
       // $("#type").val(VisitWArr.type);
        $("#code").val(VisitWArr.id);
        $('#'+VisitWArr.rank).prop('checked','checked');
        if(VisitWArr.type1=="已完成"){
          $("#type").val("1");
        }else if(VisitWArr.type1=="未完成"){
       
          $("#type").val("0");
        }else {
          $("#type").val("");
        }
        layui.form.render("select");
        layui.form.render("radio");
       
        layui.form.render("select");

      }

      function deleteVisit() {
        if (layui.table.checkStatus('demo').data.length < 1 || layui.table.checkStatus('demo').data.length > 1) {
          alert('必须选择一项进行删除');
          return;
        }
        if (window.confirm("确认删除  ？")) {

          var VisitTypeJAjax = "DeleteTemplate?"
          var ids = "";
          for (var i = 0; i < layui.table.checkStatus('demo').data.length; i++) {
            var array = layui.table.checkStatus('demo').data[i];
            ids += array.id;
          }
          var data = "id=" + ids;

          $layer.load();
          $.getJSON(url + VisitTypeJAjax + data,
            function (json) {
              $layer.closeAll('loading');
              //alert(JSON.stringify(json))
              if (json.code == 1) {
                $layer.msg("删除成功", {
                  icon: 6
                });
                window.location.reload();
              } else {
                $layer.msg("删除失败", {
                  icon: 5
                });
              }
              return;
            })

        } else {
          return;
        }
      }

      function addListDate() {
        var $input = document.getElementById("zezhaoceng3");
        $input.style.display = "block";
        $("#t_bt").html("<legend>添加</legend>");
        $("#RoleListAddBtn").attr({
          "onclick": "f_save();"
        });
        document.getElementById('name').focus();
        $("#name").val("");
        $("#content").val("");
        $("#memo").val("");

      }

      $(document).on("click", ".layui-table-body table.layui-table tbody tr", function () {
        var index = $(this).attr('data-index');
        var tableBox = $(this).parents('.layui-table-box');
        //存在固定列
        if (tableBox.find(".layui-table-fixed.layui-table-fixed-l").length > 0) {
          tableDiv = tableBox.find(".layui-table-fixed.layui-table-fixed-l");
        } else {
          tableDiv = tableBox.find(".layui-table-body.layui-table-main");
        }
        //获取已选中列并取消选中
        var trs = tableDiv.find(".layui-unselect.layui-form-checkbox.layui-form-checked").parent().parent()
      .parent();
        for (var i = 0; i < trs.length; i++) {
          var ind = $(trs[i]).attr("data-index");
          if (ind != index) {
            var checkCell = tableDiv.find("tr[data-index=" + ind + "]").find(
              "td div.laytable-cell-checkbox div.layui-form-checkbox I");
            if (checkCell.length > 0) {
              checkCell.click();
            }
          }
        }
        //选中单击行
        var checkCell = tableDiv.find("tr[data-index=" + index + "]").find(
          "td div.laytable-cell-checkbox div.layui-form-checkbox I");
        if (checkCell.length > 0) {
          checkCell.click();
        }
      });
      $(document).on("click", "td div.laytable-cell-checkbox div.layui-form-checkbox", function (e) {
        e.stopPropagation();
      });


      function f_save() {
        userDate = JSON.parse(window.sessionStorage.getItem("userNameList"));
        var  rank=$("input[name='chec']:checked").val();
      var data = "name=" + $("#name").val() +
          "&rank=" +rank +
          "&content=" + $("#content").val() +
          "&type=" + $("#type").val() +
          "&value1=" +"login" +
          "&uid=" + userDate.username ;

       $.getJSON(url + "AddTemplate?" + data,
          function (json) {
            $layer.closeAll('loading');
            var $input1 = document.getElementById("zezhaoceng3");
            $input1.style.display = "none";
            alert("保存成功")
            datelistQry();
            return;
          })
      }

      function f_updata() {
        VisitDate = JSON.parse(window.sessionStorage.getItem("VisitNameList"));
        userDate = JSON.parse(window.sessionStorage.getItem("userNameList"));
        $layer.load();
        var  rank=$("input[name='chec']:checked").val();
        var data = "name=" + $("#name").val() +
          "&rank=" +rank +
          "&content=" + $("#content").val() +
          "&type=" + $("#type").val() +
          "&id=" + $("#code").val() +
          "&uid=" + userDate.username ;

         

        $.getJSON(url + "UpdateTemplate?" + data,
          function (json) {
           alert(json.msg)
            $layer.closeAll('loading');
            var $input1 = document.getElementById("zezhaoceng3");
            $input1.style.display = "none";
            datelistQry();
            return;
          })
      } 
      //展示已知数据
      function datelistQry() {
        qryZJspDate('', "", "", "", $(
            "#qryVisitData").val(), url, serverCode,
          function (date, VisitListArr1) {
            table.render(date);

            QRYVisitListArr = VisitListArr1;
          });
      }

      $("#qryVisitListBtn").click(function () {
        datelistQry();
      })
 
      function init() {
        datelistQry();
      //  select_op();
      }
      init();

      function ZJspVisitListXR(dataList) {
        return {
          elem: '#demo',
          cols: [
            [ //标题栏
              {
                type: 'checkbox'
              },
              {
                field: 'code',
                title: '编号',
                width: 90
              }, {
                field: 'userName',
                title: '姓名',
                width: 210
              }, {
                field: 'userPhone',
                title: '手机号码',
                width: 120
              }, {
                field: 'createtime',
                title: '创建时间',
                width: 170,
                //   sort: true
              }, {
                field: 'userCode',
                title: '登录名称',
                width: 120,
                //   sort: true
              }, {
                field: 'address',
                title: '地址',
                width: 120,
                //   sort: true
              }, {
                field: 'BtnStyle',
                width: 100,
                title: '操作',
                fixed: 'right',
              }

            ]
          ],
          data: dataList,
          skin: 'line' //表格风格
            ,
          even: true,
          page: true //是否显示分页
            ,
          limits: [5, 7, 10, 20],
          limit: 5 //每页默认显示的数量
        };
        table.on('toolbar(test)', function (obj) {
          var checkStatus = table.checkStatus(obj.config.id); //获取选中行状态
          switch (obj.event) {
            case 'getCheckData':
              var data = checkStatus.data; //获取选中行数据
              layer.alert(JSON.stringify(data));
              break;
          };
        });
      }

      function ZJspVisitListXH(dataList) {
        for (var i = 0; i < dataList.length; i++) {
             if(dataList[i].type==1){
              dataList[i].type1="已完成";
             }else{
              dataList[i].type1="未完成";
             }

          dataList[i].code = (i + 1);
          dataList[i].BtnStyle = "<div>" +
            "<div style='cursor:pointer;float: left;padding: 0px 5px;background: #177ce3;border-radius: 2px;color: #fff;' onclick='VisitListWClick(" +
            i + ")'>浏览</div>" +

            "</div>"
        }
        return ZJspVisitListXR(dataList);
      }

      function qryZJspDate(dzyid, Type, S_Date, E_Date, Value1, url, serverCode, callback) {
        $layer.load();
        $("#renwuRongQi").empty();
        var data = ""; //序列化表单数据 
     
        $.getJSON(url + "getAll?" + data,
          function (json) {
             alert(JSON.stringify(json))

            VisitListWArr = json.Response.RDATA;
            $layer.closeAll('loading');
            callback(ZJspVisitListXH(VisitListWArr), VisitListWArr);
            return;
          })
      }


      function select_op() {
      $layer.load();
     
      var data = "incidentid=" + window.sessionStorage.getItem('projectid'); //序列化表单数据 
      $.getJSON(url + "CodenoSelect?" + data,
        function (json) {
          $layer.closeAll('loading');
          isshow = "true";
        var ss="";
        //  alert(json.RDATA.length) 
      for (let index = 0; index < json.RDATA.length; index++) {
        var info =  json.RDATA[index];
        if(index==0){
        ss+= '<input  type="radio" name="chec" style="margin-left:-100xp; vertical-align: -2px" id="'+info.id+'" class="che " value="'+info.id+'"  checked   title='+info.name+'>&nbsp;';
        }else{
        ss+= '<input  type="radio" name="chec" style="margin-left:-100xp; vertical-align: -2px" id="'+info.id+'" class="che " value="'+info.id+'"  title='+info.name+'>&nbsp;';
        }
          $("#rank").html(ss);
          layui.form.render("radio");
      }
        
    })

 }
    </script>
</body>

</html>